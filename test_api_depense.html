<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API D√©pense</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Test API D√©pense</h1>
    <button onclick="testCreateDepense()">Tester la cr√©ation de d√©pense</button>
    <div id="result"></div>

    <script>
        // Configuration Supabase (remplacer par vos vraies cl√©s)
        const SUPABASE_URL = 'VOTRE_SUPABASE_URL'
        const SUPABASE_ANON_KEY = 'VOTRE_SUPABASE_ANON_KEY'
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        async function testCreateDepense() {
            const resultDiv = document.getElementById('result')
            resultDiv.innerHTML = '<p>Test en cours...</p>'
            
            try {
                console.log('üîê V√©rification de l\'authentification...')
                const { data: { user }, error: authError } = await supabase.auth.getUser()
                
                if (authError) {
                    console.error('‚ùå Erreur d\'authentification:', authError)
                    resultDiv.innerHTML = `<p style="color: red;">Erreur d'authentification: ${authError.message}</p>`
                    return
                }
                
                if (!user) {
                    console.error('‚ùå Utilisateur non authentifi√©')
                    resultDiv.innerHTML = '<p style="color: red;">Utilisateur non authentifi√©</p>'
                    return
                }
                
                console.log('‚úÖ Utilisateur authentifi√©:', user.id)
                
                // Donn√©es de test
                const depenseData = {
                    user_id: user.id,
                    libelle: 'Test d√©pense API',
                    montant: 50.00,
                    date: new Date().toISOString().split('T')[0],
                    description: 'Test depuis API directe'
                }
                
                console.log('üì§ Envoi vers Supabase:', depenseData)
                
                const { data, error } = await supabase
                    .from('depenses')
                    .insert(depenseData)
                    .select()
                    .single()
                
                if (error) {
                    console.error('‚ùå Erreur Supabase:', error)
                    resultDiv.innerHTML = `<p style="color: red;">Erreur: ${error.message}</p>`
                    return
                }
                
                console.log('‚úÖ D√©pense cr√©√©e:', data)
                resultDiv.innerHTML = `<p style="color: green;">Succ√®s! D√©pense cr√©√©e avec l'ID: ${data.id}</p>`
                
            } catch (error) {
                console.error('‚ùå Erreur inattendue:', error)
                resultDiv.innerHTML = `<p style="color: red;">Erreur: ${error.message}</p>`
            }
        }
    </script>
</body>
</html>



























