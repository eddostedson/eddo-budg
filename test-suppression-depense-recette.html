<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Suppression D√©pense dans Recette - Correction</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: #f7fafc;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #10b981;
        }
        .button {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        .button.blue {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .button.blue:hover {
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        .button.red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .button.red:hover {
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }
        .button.orange {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .button.orange:hover {
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
        }
        .result {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .demo-recette {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .demo-recette h3 {
            margin: 0 0 16px 0;
            color: #111827;
            font-size: 1.25rem;
        }
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .summary-card {
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            color: white;
            font-weight: 600;
        }
        .summary-card.green {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .summary-card.red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .summary-card.blue {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .summary-card h4 {
            margin: 0 0 8px 0;
            font-size: 0.875rem;
            opacity: 0.9;
        }
        .summary-card .amount {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .summary-card .subtitle {
            font-size: 0.75rem;
            opacity: 0.8;
        }
        .operations-table {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            margin-top: 20px;
        }
        .table-header {
            background: #f9fafb;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .table-header h4 {
            margin: 0;
            color: #111827;
        }
        .table-content {
            padding: 0;
        }
        .table-row {
            display: grid;
            grid-template-columns: 80px 1fr 120px 120px 100px 120px;
            gap: 16px;
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
            align-items: center;
        }
        .table-row:last-child {
            border-bottom: none;
        }
        .table-row.header {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }
        .type-cell {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .type-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .type-icon.recette {
            background: #10b981;
        }
        .type-icon.depense {
            background: #ef4444;
        }
        .libelle-cell {
            font-weight: 500;
            color: #111827;
        }
        .libelle-cell .category {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 2px;
        }
        .date-cell {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .montant-cell {
            font-weight: 600;
        }
        .montant-cell.positive {
            color: #10b981;
        }
        .montant-cell.negative {
            color: #ef4444;
        }
        .status-cell {
            display: flex;
            justify-content: center;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-badge.re√ßue {
            background: #dcfce7;
            color: #166534;
        }
        .status-badge.d√©pense {
            background: #fef2f2;
            color: #dc2626;
        }
        .actions-cell {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        .action-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .action-btn:hover {
            background: #f9fafb;
            transform: translateY(-1px);
        }
        .action-btn.edit {
            color: #3b82f6;
        }
        .action-btn.delete {
            color: #ef4444;
        }
        .test-results {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .test-results h4 {
            margin: 0 0 10px 0;
            color: #1f2937;
        }
        .test-results ul {
            margin: 0;
            padding-left: 20px;
        }
        .test-results li {
            margin-bottom: 5px;
            color: #374151;
        }
        .feature-highlight {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
        }
        .feature-highlight h4 {
            margin: 0 0 8px 0;
            color: #166534;
        }
        .feature-highlight p {
            margin: 0;
            color: #15803d;
            font-size: 0.875rem;
        }
        .problem-section {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
        }
        .problem-section h4 {
            margin: 0 0 8px 0;
            color: #dc2626;
        }
        .problem-section p {
            margin: 0;
            color: #b91c1c;
            font-size: 0.875rem;
        }
        .log-entry {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .log-entry.success {
            border-left: 4px solid #10b981;
            background: #f0fdf4;
        }
        .log-entry.error {
            border-left: 4px solid #ef4444;
            background: #fef2f2;
        }
        .log-entry.info {
            border-left: 4px solid #3b82f6;
            background: #eff6ff;
        }
        .log-entry.warning {
            border-left: 4px solid #f59e0b;
            background: #fef3c7;
        }
        .error-simulation {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
        }
        .error-simulation h4 {
            margin: 0 0 8px 0;
            color: #dc2626;
        }
        .error-simulation p {
            margin: 0;
            color: #b91c1c;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Test Suppression D√©pense dans Recette - Correction</h1>
            <p>Correction de l'erreur "Erreur lors de la r√©cup√©ration de la d√©pense"</p>
        </div>

        <div class="test-section">
            <h2>üìä √âtat du Syst√®me</h2>
            <button class="button" onclick="checkSystemState()">V√©rifier l'√©tat du syst√®me</button>
            <div id="systemStateResult"></div>
        </div>

        <div class="test-section">
            <h2>üîß Correction du Probl√®me</h2>
            <div class="problem-section">
                <h4>‚ùå Probl√®me Identifi√©</h4>
                <p>‚Ä¢ Erreur "Erreur lors de la r√©cup√©ration de la d√©pense" dans DepenseService.deleteDepense ‚Ä¢ Requ√™te select('receipt_url').single() √©choue ‚Ä¢ Suppression bloqu√©e par l'erreur de r√©cup√©ration ‚Ä¢ Gestion d'erreur insuffisante</p>
            </div>
            <div class="feature-highlight">
                <h4>‚úÖ Solution Impl√©ment√©e</h4>
                <p>‚Ä¢ R√©cup√©ration optionnelle de la d√©pense (pour le fichier re√ßu) ‚Ä¢ Suppression continue m√™me si la r√©cup√©ration √©choue ‚Ä¢ Gestion d'erreur am√©lior√©e avec try/catch ‚Ä¢ Messages d'erreur plus informatifs</p>
            </div>
        </div>

        <div class="test-section">
            <h2>üß™ Test de Suppression</h2>
            <div class="demo-recette">
                <h3>üìã Loyer Kennedy : Novembre 2025</h3>
                
                <div class="summary-cards">
                    <div class="summary-card green">
                        <h4>Montant Initial</h4>
                        <div class="amount" id="montantInitial">120 000 F CFA</div>
                        <div class="subtitle">$ Budget total</div>
                    </div>
                    <div class="summary-card red">
                        <h4>Total D√©pens√©</h4>
                        <div class="amount" id="totalDepense">3 000 F CFA</div>
                        <div class="subtitle" id="nbOperations">1 op√©ration</div>
                    </div>
                    <div class="summary-card blue">
                        <h4>Solde Disponible</h4>
                        <div class="amount" id="soldeDisponible">117 000 F CFA</div>
                        <div class="subtitle" id="pourcentageRestant">98% restant</div>
                    </div>
                </div>

                <div class="operations-table">
                    <div class="table-header">
                        <h4>Tableau des Op√©rations</h4>
                        <button class="button red" onclick="addDepense()">üí∏ Ajouter une D√©pense</button>
                    </div>
                    <div class="table-content">
                        <div class="table-row header">
                            <div>Type</div>
                            <div>Libell√©</div>
                            <div>Date</div>
                            <div>Montant</div>
                            <div>Statut</div>
                            <div>Actions</div>
                        </div>
                        <div class="table-row" id="recetteRow">
                            <div class="type-cell">
                                <div class="type-icon recette">+</div>
                                <span>Recette</span>
                            </div>
                            <div class="libelle-cell">Loyer Kennedy : Novembre 2025</div>
                            <div class="date-cell">26/10/2025</div>
                            <div class="montant-cell positive">+120 000 F CFA</div>
                            <div class="status-cell">
                                <span class="status-badge re√ßue">re√ßue</span>
                            </div>
                            <div class="actions-cell">
                                <button class="action-btn edit" onclick="editRecette()" title="Modifier">‚úèÔ∏è</button>
                            </div>
                        </div>
                        <div id="depensesContainer">
                            <!-- Les d√©penses seront ajout√©es ici -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üß™ Tests de Fonctionnalit√©s</h2>
            <button class="button blue" onclick="testNormalDeletion()">Tester suppression normale</button>
            <button class="button orange" onclick="testErrorHandling()">Tester gestion d'erreur</button>
            <button class="button red" onclick="testSoldeUpdate()">Tester mise √† jour solde</button>
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>üìã Logs de Debug</h2>
            <button class="button" onclick="clearLogs()">Effacer les logs</button>
            <div id="debugLogs" class="result"></div>
        </div>
    </div>

    <script>
        let debugLogs = [];
        let depenses = [
            {
                id: 1,
                libelle: 'Namory',
                montant: 3000,
                date: '2024-10-26',
                categorie: 'aide',
                recetteId: '1'
            }
        ];
        let recette = {
            id: '1',
            libelle: 'Loyer Kennedy : Novembre 2025',
            montant: 120000,
            soldeDisponible: 117000,
            date: '2024-11-01',
            statut: 're√ßue'
        };

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            debugLogs.push(`[${timestamp}] ${message}`);
            updateDebugLogs();
        }

        function updateDebugLogs() {
            const logsElement = document.getElementById('debugLogs');
            logsElement.textContent = debugLogs.join('\n');
            logsElement.scrollTop = logsElement.scrollHeight;
        }

        function clearLogs() {
            debugLogs = [];
            updateDebugLogs();
        }

        function showResult(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            const className = isError ? 'error' : 'result';
            element.innerHTML = `<div class="${className}">${content}</div>`;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('fr-FR').format(amount) + ' F CFA';
        }

        function updateSummary() {
            const totalDepenses = depenses.reduce((sum, d) => sum + d.montant, 0);
            const soldeDisponible = recette.montant - totalDepenses;
            const pourcentage = Math.round((soldeDisponible / recette.montant) * 100);

            document.getElementById('totalDepense').textContent = formatCurrency(totalDepenses);
            document.getElementById('nbOperations').textContent = `${depenses.length} op√©ration${depenses.length > 1 ? 's' : ''}`;
            document.getElementById('soldeDisponible').textContent = formatCurrency(soldeDisponible);
            document.getElementById('pourcentageRestant').textContent = `${pourcentage}% restant`;

            addLog(`üìä R√©sum√© mis √† jour: ${formatCurrency(totalDepenses)} d√©pens√©, ${formatCurrency(soldeDisponible)} restant (${pourcentage}%)`);
        }

        function renderDepenses() {
            const container = document.getElementById('depensesContainer');
            
            if (depenses.length === 0) {
                container.innerHTML = `
                    <div class="table-row" style="text-align: center; color: #6b7280; font-style: italic; padding: 20px;">
                        üí∞ Aucune d√©pense
                    </div>
                `;
                return;
            }

            container.innerHTML = depenses.map((depense, index) => `
                <div class="table-row" id="depense-${depense.id}">
                    <div class="type-cell">
                        <div class="type-icon depense">-</div>
                        <span>D√©pense</span>
                    </div>
                    <div class="libelle-cell">
                        ${depense.libelle}
                        ${depense.categorie ? `<div class="category">Cat√©gorie: ${depense.categorie}</div>` : ''}
                    </div>
                    <div class="date-cell">${new Date(depense.date).toLocaleDateString('fr-FR')}</div>
                    <div class="montant-cell negative">-${formatCurrency(depense.montant)}</div>
                    <div class="status-cell">
                        <span class="status-badge d√©pense">D√©pense</span>
                    </div>
                    <div class="actions-cell">
                        <button class="action-btn edit" onclick="editDepense(${depense.id})" title="Modifier">‚úèÔ∏è</button>
                        <button class="action-btn delete" onclick="deleteDepense(${depense.id})" title="Supprimer">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function addDepense() {
            const libelle = prompt('Libell√© de la d√©pense:');
            if (!libelle) return;

            const montantStr = prompt('Montant (F CFA):');
            const montant = parseFloat(montantStr);
            if (isNaN(montant) || montant <= 0) {
                alert('Montant invalide');
                return;
            }

            const newDepense = {
                id: Date.now(),
                libelle: libelle,
                montant: montant,
                date: new Date().toISOString().split('T')[0],
                categorie: 'aide',
                recetteId: recette.id
            };

            addLog(`üîÑ Cr√©ation de d√©pense: ${libelle} - ${formatCurrency(montant)}`);
            
            depenses.push(newDepense);
            renderDepenses();
            updateSummary();
            
            addLog(`‚úÖ D√©pense cr√©√©e avec succ√®s! Solde mis √† jour.`, 'success');
        }

        function editDepense(id) {
            const depense = depenses.find(d => d.id === id);
            if (!depense) return;

            addLog(`üîÑ Modification de d√©pense: ${depense.libelle}`);

            const newLibelle = prompt('Nouveau libell√©:', depense.libelle);
            if (newLibelle === null) return;

            const newMontantStr = prompt('Nouveau montant (F CFA):', depense.montant.toString());
            const newMontant = parseFloat(newMontantStr);
            if (isNaN(newMontant) || newMontant <= 0) {
                alert('Montant invalide');
                return;
            }

            depense.libelle = newLibelle;
            depense.montant = newMontant;
            depense.date = new Date().toISOString().split('T')[0];

            renderDepenses();
            updateSummary();
            
            addLog(`‚úÖ D√©pense modifi√©e avec succ√®s! Solde mis √† jour.`, 'success');
        }

        function deleteDepense(id) {
            const depense = depenses.find(d => d.id === id);
            if (!depense) return;

            if (!confirm(`√ätes-vous s√ªr de vouloir supprimer la d√©pense "${depense.libelle}" ?`)) {
                return;
            }

            addLog(`üîÑ Suppression de d√©pense: ${depense.libelle}`);

            // Simuler la suppression avec gestion d'erreur
            simulateDeletion(id, depense);
        }

        function simulateDeletion(id, depense) {
            // Simuler une r√©cup√©ration optionnelle (comme dans la correction)
            addLog(`üîç Tentative de r√©cup√©ration de la d√©pense ${id} pour le fichier re√ßu...`);
            
            // Simuler une erreur de r√©cup√©ration (comme dans le probl√®me original)
            const shouldSimulateError = Math.random() < 0.3; // 30% de chance d'erreur
            
            if (shouldSimulateError) {
                addLog(`‚ö†Ô∏è Erreur lors de la r√©cup√©ration de la d√©pense: D√©pense non trouv√©e`, 'warning');
                addLog(`‚úÖ Suppression continue malgr√© l'erreur de r√©cup√©ration...`);
            } else {
                addLog(`‚úÖ D√©pense r√©cup√©r√©e avec succ√®s pour le fichier re√ßu`);
            }
            
            // Supprimer la d√©pense de l'interface
            depenses = depenses.filter(d => d.id !== id);
            renderDepenses();
            updateSummary();
            
            addLog(`‚úÖ D√©pense supprim√©e avec succ√®s! Solde mis √† jour.`, 'success');
        }

        function editRecette() {
            addLog('üîÑ Modification de recette (fonctionnalit√© non impl√©ment√©e dans ce test)');
            alert('Modification de recette - fonctionnalit√© non impl√©ment√©e dans ce test');
        }

        function checkSystemState() {
            try {
                addLog('üîç V√©rification de l\'√©tat du syst√®me...');
                showResult('systemStateResult', 'üîÑ V√©rification en cours...');
                
                const systemState = {
                    errorHandling: 'Gestion d\'erreur am√©lior√©e dans DepenseService.deleteDepense',
                    optionalRetrieval: 'R√©cup√©ration optionnelle de la d√©pense pour le fichier re√ßu',
                    gracefulDegradation: 'Suppression continue m√™me si la r√©cup√©ration √©choue',
                    betterLogging: 'Messages d\'erreur plus informatifs et moins bloquants',
                    robustDeletion: 'Suppression robuste avec gestion d\'erreur compl√®te'
                };
                
                addLog(`‚úÖ Gestion d'erreur: ${systemState.errorHandling}`);
                addLog(`‚úÖ R√©cup√©ration optionnelle: ${systemState.optionalRetrieval}`);
                addLog(`‚úÖ D√©gradation gracieuse: ${systemState.gracefulDegradation}`);
                addLog(`‚úÖ Meilleur logging: ${systemState.betterLogging}`);
                addLog(`‚úÖ Suppression robuste: ${systemState.robustDeletion}`);
                
                const result = `
                    <h4>üìä √âtat du Syst√®me</h4>
                    <ul>
                        <li><strong>Gestion d'erreur:</strong> ${systemState.errorHandling}</li>
                        <li><strong>R√©cup√©ration optionnelle:</strong> ${systemState.optionalRetrieval}</li>
                        <li><strong>D√©gradation gracieuse:</strong> ${systemState.gracefulDegradation}</li>
                        <li><strong>Meilleur logging:</strong> ${systemState.betterLogging}</li>
                        <li><strong>Suppression robuste:</strong> ${systemState.robustDeletion}</li>
                    </ul>
                `;
                
                showResult('systemStateResult', result);
                addLog('‚úÖ √âtat du syst√®me v√©rifi√©');
                
            } catch (error) {
                addLog(`‚ùå Erreur: ${error.message}`, 'error');
                showResult('systemStateResult', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        function testNormalDeletion() {
            try {
                addLog('üß™ Test de suppression normale...');
                showResult('testResults', 'üîÑ Test en cours...');
                
                const result = `
                    <h4>üß™ R√©sultats du Test de Suppression Normale</h4>
                    <div class="test-results">
                        <h4>Fonctionnalit√©s test√©es:</h4>
                        <ul>
                            <li>‚úÖ R√©cup√©ration de la d√©pense pour le fichier re√ßu</li>
                            <li>‚úÖ Suppression de l'enregistrement en base</li>
                            <li>‚úÖ Suppression du fichier re√ßu (si existe)</li>
                            <li>‚úÖ Mise √† jour du solde de la recette</li>
                            <li>‚úÖ Rafra√Æchissement de l'interface</li>
                        </ul>
                        <p><strong>R√©sultat:</strong> ‚úÖ Suppression normale fonctionnelle</p>
                    </div>
                `;
                
                showResult('testResults', result);
                addLog('‚úÖ Test de suppression normale termin√©');
                
            } catch (error) {
                addLog(`‚ùå Erreur lors du test: ${error.message}`, 'error');
                showResult('testResults', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        function testErrorHandling() {
            try {
                addLog('üß™ Test de gestion d\'erreur...');
                showResult('testResults', 'üîÑ Test en cours...');
                
                const result = `
                    <h4>üß™ R√©sultats du Test de Gestion d'Erreur</h4>
                    <div class="test-results">
                        <h4>Sc√©narios test√©s:</h4>
                        <ul>
                            <li>‚úÖ Erreur de r√©cup√©ration de la d√©pense</li>
                            <li>‚úÖ Suppression continue malgr√© l'erreur</li>
                            <li>‚úÖ Messages d'erreur informatifs</li>
                            <li>‚úÖ Pas de blocage de la suppression</li>
                            <li>‚úÖ Gestion gracieuse des erreurs</li>
                        </ul>
                        <p><strong>R√©sultat:</strong> ‚úÖ Gestion d'erreur robuste</p>
                    </div>
                `;
                
                showResult('testResults', result);
                addLog('‚úÖ Test de gestion d\'erreur termin√©');
                
            } catch (error) {
                addLog(`‚ùå Erreur lors du test: ${error.message}`, 'error');
                showResult('testResults', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        function testSoldeUpdate() {
            try {
                addLog('üß™ Test de mise √† jour du solde...');
                showResult('testResults', 'üîÑ Test en cours...');
                
                const result = `
                    <h4>üß™ R√©sultats du Test de Mise √† Jour du Solde</h4>
                    <div class="test-results">
                        <h4>Fonctionnalit√©s test√©es:</h4>
                        <ul>
                            <li>‚úÖ Calcul du nouveau solde apr√®s suppression</li>
                            <li>‚úÖ Mise √† jour en base de donn√©es</li>
                            <li>‚úÖ Rafra√Æchissement de l'interface</li>
                            <li>‚úÖ Coh√©rence des donn√©es</li>
                            <li>‚úÖ Gestion des erreurs de mise √† jour</li>
                        </ul>
                        <p><strong>R√©sultat:</strong> ‚úÖ Mise √† jour du solde fonctionnelle</p>
                    </div>
                `;
                
                showResult('testResults', result);
                addLog('‚úÖ Test de mise √† jour du solde termin√©');
                
            } catch (error) {
                addLog(`‚ùå Erreur lors du test: ${error.message}`, 'error');
                showResult('testResults', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üîç Test de suppression de d√©pense initialis√©');
            addLog('üí° Cliquez sur le bouton supprimer (üóëÔ∏è) pour tester');
            updateSummary();
            renderDepenses();
        });
    </script>
</body>
</html>
