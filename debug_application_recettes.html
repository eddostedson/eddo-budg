<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Application Recettes</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .debug-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { color: #d32f2f; background: #ffebee; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { color: #2e7d32; background: #e8f5e8; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .info { color: #1976d2; background: #e3f2fd; padding: 10px; border-radius: 5px; margin: 10px 0; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        .log { background: #000; color: #0f0; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üîß Debug Application Recettes</h1>
    
    <div class="debug-section">
        <h2>1. V√©rification de l'Authentification</h2>
        <button onclick="checkAuth()">V√©rifier l'Authentification</button>
        <div id="auth-result"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. Test de Cr√©ation de Recette</h2>
        <button onclick="testCreateRecette()">Tester la Cr√©ation</button>
        <div id="create-result"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. V√©rification des Services</h2>
        <button onclick="checkServices()">V√©rifier les Services</button>
        <div id="services-result"></div>
    </div>
    
    <div class="debug-section">
        <h2>4. Logs de Debug</h2>
        <button onclick="clearLogs()">Effacer les Logs</button>
        <div id="debug-logs" class="log"></div>
    </div>

    <script>
        // Configuration Supabase (remplacer par vos vraies valeurs)
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
        
        let supabase;
        
        // Initialiser Supabase
        async function initSupabase() {
            if (typeof window.supabase === 'undefined') {
                log('‚ùå Supabase non initialis√©. Veuillez configurer les variables SUPABASE_URL et SUPABASE_ANON_KEY');
                return false;
            }
            supabase = window.supabase;
            return true;
        }
        
        // Fonction de log
        function log(message) {
            const logDiv = document.getElementById('debug-logs');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Effacer les logs
        function clearLogs() {
            document.getElementById('debug-logs').textContent = '';
        }
        
        // V√©rifier l'authentification
        async function checkAuth() {
            const resultDiv = document.getElementById('auth-result');
            resultDiv.innerHTML = '';
            
            try {
                if (!await initSupabase()) {
                    resultDiv.innerHTML = '<div class="error">‚ùå Supabase non configur√©</div>';
                    return;
                }
                
                const { data: { user }, error } = await supabase.auth.getUser();
                
                if (error) {
                    log('‚ùå Erreur d\'authentification: ' + error.message);
                    resultDiv.innerHTML = '<div class="error">‚ùå Erreur d\'authentification: ' + error.message + '</div>';
                } else if (user) {
                    log('‚úÖ Utilisateur connect√©: ' + user.email);
                    resultDiv.innerHTML = '<div class="success">‚úÖ Utilisateur connect√©: ' + user.email + '</div>';
                } else {
                    log('‚ùå Aucun utilisateur connect√©');
                    resultDiv.innerHTML = '<div class="error">‚ùå Aucun utilisateur connect√©</div>';
                }
            } catch (error) {
                log('‚ùå Erreur inattendue: ' + error.message);
                resultDiv.innerHTML = '<div class="error">‚ùå Erreur inattendue: ' + error.message + '</div>';
            }
        }
        
        // Tester la cr√©ation de recette
        async function testCreateRecette() {
            const resultDiv = document.getElementById('create-result');
            resultDiv.innerHTML = '';
            
            try {
                if (!await initSupabase()) {
                    resultDiv.innerHTML = '<div class="error">‚ùå Supabase non configur√©</div>';
                    return;
                }
                
                // V√©rifier l'authentification
                const { data: { user }, error: authError } = await supabase.auth.getUser();
                if (authError || !user) {
                    log('‚ùå Erreur d\'authentification: ' + (authError?.message || 'Utilisateur non connect√©'));
                    resultDiv.innerHTML = '<div class="error">‚ùå Erreur d\'authentification</div>';
                    return;
                }
                
                log('üîÑ Test de cr√©ation de recette...');
                
                // Donn√©es de test
                const testData = {
                    user_id: user.id,
                    description: 'TEST DEBUG - ' + new Date().toISOString(),
                    amount: 1000.00,
                    receipt_date: new Date().toISOString().split('T')[0],
                    solde_disponible: 1000.00
                };
                
                log('üìä Donn√©es de test: ' + JSON.stringify(testData, null, 2));
                
                // Tentative d'insertion
                const { data, error } = await supabase
                    .from('recettes')
                    .insert(testData)
                    .select()
                    .single();
                
                if (error) {
                    log('‚ùå Erreur lors de l\'insertion: ' + error.message);
                    log('üîç Code erreur: ' + error.code);
                    resultDiv.innerHTML = '<div class="error">‚ùå Erreur: ' + error.message + '</div>';
                } else {
                    log('‚úÖ Recette cr√©√©e avec succ√®s: ' + data.id);
                    resultDiv.innerHTML = '<div class="success">‚úÖ Recette cr√©√©e avec succ√®s!</div>';
                    
                    // Supprimer la recette de test
                    await supabase
                        .from('recettes')
                        .delete()
                        .eq('id', data.id);
                    
                    log('üßπ Recette de test supprim√©e');
                }
                
            } catch (error) {
                log('‚ùå Erreur inattendue: ' + error.message);
                resultDiv.innerHTML = '<div class="error">‚ùå Erreur inattendue: ' + error.message + '</div>';
            }
        }
        
        // V√©rifier les services
        async function checkServices() {
            const resultDiv = document.getElementById('services-result');
            resultDiv.innerHTML = '';
            
            let services = [];
            
            // V√©rifier DirectService
            if (typeof window.DirectService !== 'undefined') {
                services.push('‚úÖ DirectService disponible');
            } else {
                services.push('‚ùå DirectService non disponible');
            }
            
            // V√©rifier RecetteService
            if (typeof window.RecetteService !== 'undefined') {
                services.push('‚úÖ RecetteService disponible');
            } else {
                services.push('‚ùå RecetteService non disponible');
            }
            
            // V√©rifier Supabase
            if (typeof window.supabase !== 'undefined') {
                services.push('‚úÖ Supabase disponible');
            } else {
                services.push('‚ùå Supabase non disponible');
            }
            
            resultDiv.innerHTML = '<div class="info">' + services.join('<br>') + '</div>';
            
            services.forEach(service => log(service));
        }
        
        // Initialiser au chargement
        window.addEventListener('load', function() {
            log('üöÄ Debug Application Recettes initialis√©');
            log('üìã Instructions:');
            log('1. Cliquez sur "V√©rifier l\'Authentification"');
            log('2. Cliquez sur "Tester la Cr√©ation"');
            log('3. Cliquez sur "V√©rifier les Services"');
            log('4. Regardez les logs pour les d√©tails');
        });
    </script>
</body>
</html>





