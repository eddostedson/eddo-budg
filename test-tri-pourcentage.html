<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Tri par Pourcentage - Recettes</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: #f7fafc;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #10b981;
        }
        .button {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        .button.blue {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .button.blue:hover {
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        .button.purple {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        .button.purple:hover {
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }
        .result {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .sort-controls {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .sort-controls h3 {
            margin: 0 0 15px 0;
            color: #1f2937;
        }
        .sort-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .sort-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        .sort-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .sort-btn:hover {
            background: #f3f4f6;
        }
        .sort-btn.active:hover {
            background: #2563eb;
        }
        .demo-data {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .demo-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 15px;
        }
        .recettes-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .recette-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }
        .recette-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        .recette-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .recette-title {
            font-weight: 600;
            color: #1f2937;
            font-size: 1.1rem;
        }
        .recette-percentage {
            font-weight: bold;
            font-size: 1.2rem;
        }
        .recette-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            margin-top: 12px;
        }
        .detail-group {
            text-align: center;
        }
        .detail-value {
            font-weight: 600;
            color: #1f2937;
            font-size: 1.1rem;
        }
        .detail-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 4px;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        .progress-100 {
            background: linear-gradient(90deg, #10b981, #059669);
        }
        .progress-high {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
        }
        .progress-medium {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }
        .progress-low {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-100 {
            background: #dcfce7;
            color: #166534;
        }
        .status-high {
            background: #dbeafe;
            color: #1e40af;
        }
        .status-medium {
            background: #fef3c7;
            color: #92400e;
        }
        .status-low {
            background: #fecaca;
            color: #dc2626;
        }
        .test-results {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .test-results h4 {
            margin: 0 0 10px 0;
            color: #1f2937;
        }
        .test-results ul {
            margin: 0;
            padding-left: 20px;
        }
        .test-results li {
            margin-bottom: 5px;
            color: #374151;
        }
        .sort-explanation {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .sort-explanation h4 {
            margin: 0 0 10px 0;
            color: #92400e;
        }
        .sort-explanation p {
            margin: 0;
            color: #92400e;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Test Tri par Pourcentage - Recettes</h1>
            <p>Test du tri intelligent par pourcentage de solde disponible</p>
        </div>

        <div class="test-section">
            <h2>üìä √âtat du Syst√®me</h2>
            <button class="button" onclick="checkSystemState()">V√©rifier l'√©tat du syst√®me</button>
            <div id="systemStateResult"></div>
        </div>

        <div class="test-section">
            <h2>üéõÔ∏è Contr√¥les de Tri</h2>
            <div class="sort-controls">
                <h3>Options de Tri</h3>
                <div class="sort-buttons">
                    <span>Trier par :</span>
                    <button class="sort-btn" onclick="setSort('libelle')" id="sortLibelle">
                        <span>üìù</span> Nom
                    </button>
                    <button class="sort-btn" onclick="setSort('montant')" id="sortMontant">
                        <span>üí∞</span> Montant
                    </button>
                    <button class="sort-btn" onclick="setSort('date')" id="sortDate">
                        <span>üìÖ</span> Date
                    </button>
                    <button class="sort-btn" onclick="setSort('solde')" id="sortSolde">
                        <span>üí≥</span> Solde
                    </button>
                    <button class="sort-btn active" onclick="setSort('pourcentage')" id="sortPourcentage">
                        <span>üìä</span> Pourcentage
                    </button>
                </div>
                
                <div class="sort-explanation">
                    <h4>üß† Logique de Tri par Pourcentage</h4>
                    <p><strong>Ordre intelligent :</strong> 100% disponibles ‚Üí Faibles (1-99%) ‚Üí √âpuis√©es (0%)</p>
                    <p>Les recettes avec 100% de solde disponible apparaissent en premier, suivies des recettes avec des pourcentages d√©croissants, et enfin les recettes √©puis√©es.</p>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìã Donn√©es de D√©monstration</h2>
            <div class="demo-data">
                <div class="demo-title">Recettes Tri√©es par Pourcentage</div>
                <div id="recettesContainer" class="recettes-list">
                    <!-- Les recettes seront g√©n√©r√©es ici -->
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üß™ Tests de Fonctionnalit√©s</h2>
            <button class="button blue" onclick="testPercentageSort()">Tester le tri par pourcentage</button>
            <button class="button purple" onclick="testSortLogic()">Tester la logique de tri</button>
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>üìã Logs de Debug</h2>
            <button class="button" onclick="clearLogs()">Effacer les logs</button>
            <div id="debugLogs" class="result"></div>
        </div>
    </div>

    <script>
        let debugLogs = [];
        let currentSort = 'pourcentage';

        // Donn√©es de d√©monstration avec diff√©rents pourcentages
        const demoRecettes = [
            {
                id: '1',
                libelle: 'BSIC - SOLDE EXPERTISE',
                montant: 1639219,
                soldeDisponible: 1639219,
                date: '2024-01-15',
                description: 'Solde complet disponible'
            },
            {
                id: '2',
                libelle: 'EXPERTISE : Budget de Fonctionnement Aout 2025',
                montant: 500000,
                soldeDisponible: 237751,
                date: '2024-01-10',
                description: 'Budget partiellement utilis√©'
            },
            {
                id: '3',
                libelle: 'Vente Mat√©riel Informatique',
                montant: 75000,
                soldeDisponible: 0,
                date: '2024-01-20',
                description: 'Vente termin√©e, solde √©puis√©'
            },
            {
                id: '4',
                libelle: 'Consultation Client Premium',
                montant: 200000,
                soldeDisponible: 200000,
                date: '2024-01-05',
                description: 'Consultation non encore commenc√©e'
            },
            {
                id: '5',
                libelle: 'BSIC REVERSEMENT SUR PRECOMPTE : NUMERAIRE',
                montant: 430000,
                soldeDisponible: 45129,
                date: '2024-01-25',
                description: 'Reversement largement utilis√©'
            },
            {
                id: '6',
                libelle: 'EXPERTISE : Budget de Fonctionnement Juillet 2025',
                montant: 462000,
                soldeDisponible: 14200,
                date: '2024-01-12',
                description: 'Budget presque √©puis√©'
            },
            {
                id: '7',
                libelle: 'Formation en Ligne',
                montant: 30000,
                soldeDisponible: 30000,
                date: '2024-01-30',
                description: 'Formation non encore commenc√©e'
            },
            {
                id: '8',
                libelle: 'Maintenance Serveur',
                montant: 100000,
                soldeDisponible: 0,
                date: '2024-01-01',
                description: 'Maintenance termin√©e'
            }
        ];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            debugLogs.push(`[${timestamp}] ${message}`);
            updateDebugLogs();
        }

        function updateDebugLogs() {
            const logsElement = document.getElementById('debugLogs');
            logsElement.textContent = debugLogs.join('\n');
            logsElement.scrollTop = logsElement.scrollHeight;
        }

        function clearLogs() {
            debugLogs = [];
            updateDebugLogs();
        }

        function showResult(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            const className = isError ? 'error' : 'result';
            element.innerHTML = `<div class="${className}">${content}</div>`;
        }

        function setSort(field) {
            addLog(`üîÑ Changement de tri: ${currentSort} ‚Üí ${field}`);
            currentSort = field;
            
            // Mettre √† jour les boutons
            document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('sort' + field.charAt(0).toUpperCase() + field.slice(1)).classList.add('active');
            
            renderRecettes();
        }

        function getPercentage(recette) {
            return recette.montant > 0 ? Math.round((recette.soldeDisponible / recette.montant) * 100) : 0;
        }

        function getPercentageClass(percentage) {
            if (percentage === 100) return 'progress-100';
            if (percentage >= 50) return 'progress-high';
            if (percentage >= 20) return 'progress-medium';
            return 'progress-low';
        }

        function getStatusClass(percentage) {
            if (percentage === 100) return 'status-100';
            if (percentage >= 50) return 'status-high';
            if (percentage >= 20) return 'status-medium';
            return 'status-low';
        }

        function getStatusText(percentage) {
            if (percentage === 100) return 'Disponible';
            if (percentage >= 50) return '√âlev√©';
            if (percentage >= 20) return 'Moyen';
            return 'Faible';
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('fr-FR').format(amount) + ' F CFA';
        }

        function sortRecettes(recettes, sortBy) {
            return [...recettes].sort((a, b) => {
                switch (sortBy) {
                    case 'libelle':
                        return a.libelle.localeCompare(b.libelle);
                    case 'montant':
                        return b.montant - a.montant;
                    case 'date':
                        return new Date(a.date) - new Date(b.date);
                    case 'solde':
                        return b.soldeDisponible - a.soldeDisponible;
                    case 'pourcentage':
                        // Logique de tri sp√©ciale pour le pourcentage
                        const aPourcentage = getPercentage(a);
                        const bPourcentage = getPercentage(b);
                        
                        // 100% en premier
                        if (aPourcentage === 100 && bPourcentage !== 100) return -1;
                        if (bPourcentage === 100 && aPourcentage !== 100) return 1;
                        
                        // 0% en dernier
                        if (aPourcentage === 0 && bPourcentage !== 0) return 1;
                        if (bPourcentage === 0 && aPourcentage !== 0) return -1;
                        
                        // Pour les autres, tri d√©croissant
                        return bPourcentage - aPourcentage;
                    default:
                        return 0;
                }
            });
        }

        function renderRecettes() {
            const container = document.getElementById('recettesContainer');
            const sortedRecettes = sortRecettes(demoRecettes, currentSort);
            
            container.innerHTML = sortedRecettes.map((recette, index) => {
                const percentage = getPercentage(recette);
                const percentageClass = getPercentageClass(percentage);
                const statusClass = getStatusClass(percentage);
                const statusText = getStatusText(percentage);
                
                return `
                    <div class="recette-item">
                        <div class="recette-header">
                            <div class="recette-title">${recette.libelle}</div>
                            <div class="recette-percentage ${statusClass}">${percentage}%</div>
                        </div>
                        <div class="recette-details">
                            <div class="detail-group">
                                <div class="detail-value">${formatCurrency(recette.montant)}</div>
                                <div class="detail-label">Montant Total</div>
                            </div>
                            <div class="detail-group">
                                <div class="detail-value">${formatCurrency(recette.soldeDisponible)}</div>
                                <div class="detail-label">Solde Disponible</div>
                            </div>
                            <div class="detail-group">
                                <div class="detail-value">${recette.date}</div>
                                <div class="detail-label">Date</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill ${percentageClass}" style="width: ${percentage}%"></div>
                        </div>
                        <div style="margin-top: 8px; text-align: center;">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            addLog(`‚úÖ ${sortedRecettes.length} recettes rendues avec tri par ${currentSort}`);
        }

        function checkSystemState() {
            try {
                addLog('üîç V√©rification de l\'√©tat du syst√®me...');
                showResult('systemStateResult', 'üîÑ V√©rification en cours...');
                
                const systemState = {
                    sortOptionsSupported: ['libelle', 'montant', 'date', 'solde', 'pourcentage'],
                    currentSort: currentSort,
                    demoDataCount: demoRecettes.length,
                    percentageSortLogic: '100% ‚Üí faibles ‚Üí √©puis√©es'
                };
                
                addLog(`‚úÖ Options de tri support√©es: ${systemState.sortOptionsSupported.join(', ')}`);
                addLog(`‚úÖ Tri actuel: ${systemState.currentSort}`);
                addLog(`‚úÖ Donn√©es de d√©monstration: ${systemState.demoDataCount} recettes`);
                addLog(`‚úÖ Logique de tri par pourcentage: ${systemState.percentageSortLogic}`);
                
                const result = `
                    <h4>üìä √âtat du Syst√®me</h4>
                    <ul>
                        <li><strong>Options de tri:</strong> ${systemState.sortOptionsSupported.join(', ')}</li>
                        <li><strong>Tri actuel:</strong> ${systemState.currentSort}</li>
                        <li><strong>Donn√©es:</strong> ${systemState.demoDataCount} recettes</li>
                        <li><strong>Logique pourcentage:</strong> ${systemState.percentageSortLogic}</li>
                    </ul>
                `;
                
                showResult('systemStateResult', result);
                addLog('‚úÖ √âtat du syst√®me v√©rifi√©');
                
            } catch (error) {
                addLog(`‚ùå Erreur: ${error.message}`, 'error');
                showResult('systemStateResult', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        function testPercentageSort() {
            try {
                addLog('üß™ Test du tri par pourcentage...');
                showResult('testResults', 'üîÑ Test en cours...');
                
                const sortedRecettes = sortRecettes(demoRecettes, 'pourcentage');
                let testResults = [];
                
                // V√©rifier l'ordre de tri
                let has100Percent = false;
                let hasLowPercent = false;
                let has0Percent = false;
                
                sortedRecettes.forEach((recette, index) => {
                    const percentage = getPercentage(recette);
                    
                    if (percentage === 100) has100Percent = true;
                    if (percentage > 0 && percentage < 100) hasLowPercent = true;
                    if (percentage === 0) has0Percent = true;
                    
                    testResults.push({
                        index: index + 1,
                        libelle: recette.libelle,
                        percentage,
                        correct: true
                    });
                    
                    addLog(`‚úÖ Position ${index + 1}: ${recette.libelle} (${percentage}%)`);
                });
                
                const result = `
                    <h4>üß™ R√©sultats du Test de Tri par Pourcentage</h4>
                    <div class="test-results">
                        <h4>Ordre de tri v√©rifi√©:</h4>
                        <ul>
                            ${testResults.map(r => 
                                `<li><strong>${r.index}.</strong> ${r.libelle} - ${r.percentage}%</li>`
                            ).join('')}
                        </ul>
                        <p><strong>Logique respect√©e:</strong> ${has100Percent ? '‚úÖ 100% en premier' : '‚ùå 100% manquant'} | ${hasLowPercent ? '‚úÖ Faibles au milieu' : '‚ùå Faibles manquants'} | ${has0Percent ? '‚úÖ 0% en dernier' : '‚ùå 0% manquant'}</p>
                    </div>
                `;
                
                showResult('testResults', result);
                addLog(`‚úÖ Test termin√©: ${testResults.length} recettes tri√©es correctement`);
                
            } catch (error) {
                addLog(`‚ùå Erreur lors du test: ${error.message}`, 'error');
                showResult('testResults', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        function testSortLogic() {
            try {
                addLog('üß™ Test de la logique de tri...');
                showResult('testResults', 'üîÑ Test en cours...');
                
                const testCases = [
                    { a: 100, b: 50, expected: -1, description: '100% vs 50% (100% en premier)' },
                    { a: 50, b: 100, expected: 1, description: '50% vs 100% (100% en premier)' },
                    { a: 0, b: 50, expected: 1, description: '0% vs 50% (0% en dernier)' },
                    { a: 50, b: 0, expected: -1, description: '50% vs 0% (0% en dernier)' },
                    { a: 80, b: 60, expected: -1, description: '80% vs 60% (d√©croissant)' },
                    { a: 60, b: 80, expected: 1, description: '60% vs 80% (d√©croissant)' }
                ];
                
                let testResults = [];
                
                testCases.forEach((testCase, index) => {
                    const result = testCase.a === 100 && testCase.b !== 100 ? -1 :
                                  testCase.b === 100 && testCase.a !== 100 ? 1 :
                                  testCase.a === 0 && testCase.b !== 0 ? 1 :
                                  testCase.b === 0 && testCase.a !== 0 ? -1 :
                                  testCase.b - testCase.a;
                    
                    const success = result === testCase.expected;
                    testResults.push({
                        test: index + 1,
                        description: testCase.description,
                        success,
                        result,
                        expected: testCase.expected
                    });
                    
                    addLog(`‚úÖ Test ${index + 1}: ${testCase.description} - ${success ? 'Succ√®s' : '√âchec'} (r√©sultat: ${result}, attendu: ${testCase.expected})`);
                });
                
                const successCount = testResults.filter(r => r.success).length;
                const totalCount = testResults.length;
                
                const result = `
                    <h4>üß™ R√©sultats des Tests de Logique</h4>
                    <div class="test-results">
                        <h4>Tests de logique:</h4>
                        <ul>
                            ${testResults.map(r => 
                                `<li><strong>Test ${r.test}:</strong> ${r.description} - ${r.success ? '‚úÖ Succ√®s' : '‚ùå √âchec'} (${r.result}/${r.expected})</li>`
                            ).join('')}
                        </ul>
                        <p><strong>R√©sum√©:</strong> ${successCount}/${totalCount} tests r√©ussis</p>
                    </div>
                `;
                
                showResult('testResults', result);
                addLog(`‚úÖ Test termin√©: ${successCount}/${totalCount} tests de logique r√©ussis`);
                
            } catch (error) {
                addLog(`‚ùå Erreur lors du test: ${error.message}`, 'error');
                showResult('testResults', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üîç Test du tri par pourcentage initialis√©');
            addLog('üí° Cliquez sur "V√©rifier l\'√©tat du syst√®me" pour commencer');
            renderRecettes();
        });
    </script>
</body>
</html>
