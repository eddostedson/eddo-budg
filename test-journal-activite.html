<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Journal d'Activit√© - Eddo Budget</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: #f7fafc;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #10b981;
        }
        .button {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }
        .button.blue {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .button.blue:hover {
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        .button.red {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .button.red:hover {
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.3);
        }
        .result {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .activity-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .activity-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        .activity-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        .activity-icon.create {
            background: #dcfce7;
            color: #166534;
        }
        .activity-icon.update {
            background: #dbeafe;
            color: #1d4ed8;
        }
        .activity-icon.delete {
            background: #fecaca;
            color: #dc2626;
        }
        .activity-content {
            flex: 1;
        }
        .activity-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }
        .activity-time {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .activity-badges {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge.action {
            background: #f3f4f6;
            color: #374151;
        }
        .badge.entity {
            background: #eff6ff;
            color: #1d4ed8;
        }
        .badge.recette {
            background: #f0fdf4;
            color: #166534;
        }
        .badge.depense {
            background: #fef3c7;
            color: #92400e;
        }
        .activity-details {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f3f4f6;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
        }
        .stat-card.total .stat-number {
            color: #3b82f6;
        }
        .stat-card.today .stat-number {
            color: #10b981;
        }
        .stat-card.week .stat-number {
            color: #f59e0b;
        }
        .stat-card.creations .stat-number {
            color: #8b5cf6;
        }
        .filters {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            font-size: 0.875rem;
        }
        .actions {
            display: flex;
            gap: 8px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .test-results {
            background: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .test-results h4 {
            margin: 0 0 10px 0;
            color: #1f2937;
        }
        .test-results ul {
            margin: 0;
            padding-left: 20px;
        }
        .test-results li {
            margin-bottom: 5px;
            color: #374151;
        }
        .feature-highlight {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 12px;
            margin: 10px 0;
        }
        .feature-highlight h4 {
            margin: 0 0 8px 0;
            color: #166534;
        }
        .feature-highlight p {
            margin: 0;
            color: #15803d;
            font-size: 0.875rem;
        }
        .log-entry {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .log-entry.success {
            border-left: 4px solid #10b981;
            background: #f0fdf4;
        }
        .log-entry.error {
            border-left: 4px solid #ef4444;
            background: #fef2f2;
        }
        .log-entry.info {
            border-left: 4px solid #3b82f6;
            background: #eff6ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù Test Journal d'Activit√© - Eddo Budget</h1>
            <p>Syst√®me complet de tra√ßabilit√© des transactions (cr√©ation, modification, suppression)</p>
        </div>

        <div class="test-section">
            <h2>üìä √âtat du Syst√®me</h2>
            <button class="button" onclick="checkSystemState()">V√©rifier l'√©tat du syst√®me</button>
            <div id="systemStateResult"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Fonctionnalit√©s du Journal d'Activit√©</h2>
            <div class="feature-highlight">
                <h4>‚ú® Caract√©ristiques Principales</h4>
                <p>‚Ä¢ Tra√ßabilit√© compl√®te des recettes et d√©penses ‚Ä¢ Logging automatique des cr√©ations, modifications et suppressions ‚Ä¢ Interface de consultation avec filtres ‚Ä¢ Export des logs ‚Ä¢ Statistiques en temps r√©el ‚Ä¢ Stockage local persistant</p>
            </div>
            <div class="feature-highlight">
                <h4>üîç Types d'Activit√©s Tra√ß√©es</h4>
                <p>‚Ä¢ <strong>Cr√©ation :</strong> Nouvelles recettes et d√©penses ‚Ä¢ <strong>Modification :</strong> Changements sur les entit√©s existantes ‚Ä¢ <strong>Suppression :</strong> Suppression d'entit√©s avec sauvegarde des donn√©es</p>
            </div>
        </div>

        <div class="test-section">
            <h2>üìà Statistiques du Journal</h2>
            <div id="statsContainer" class="stats-grid">
                <!-- Les statistiques seront g√©n√©r√©es ici -->
            </div>
        </div>

        <div class="test-section">
            <h2>üîç Filtres et Actions</h2>
            <div class="filters">
                <select id="entityFilter" class="filter-select" onchange="applyFilters()">
                    <option value="all">Tous les types</option>
                    <option value="recette">Recettes</option>
                    <option value="depense">D√©penses</option>
                </select>
                <select id="actionFilter" class="filter-select" onchange="applyFilters()">
                    <option value="all">Toutes les actions</option>
                    <option value="create">Cr√©ations</option>
                    <option value="update">Modifications</option>
                    <option value="delete">Suppressions</option>
                </select>
                <select id="dateFilter" class="filter-select" onchange="applyFilters()">
                    <option value="all">Toutes les dates</option>
                    <option value="today">Aujourd'hui</option>
                    <option value="week">Cette semaine</option>
                    <option value="month">Ce mois</option>
                </select>
            </div>
            <div class="actions">
                <button class="button blue" onclick="exportLogs()">üì• Exporter les logs</button>
                <button class="button" onclick="clearOldLogs()">üßπ Nettoyer les anciens logs</button>
                <button class="button red" onclick="clearAllLogs()">üóëÔ∏è Effacer tous les logs</button>
            </div>
        </div>

        <div class="test-section">
            <h2>üìã Journal d'Activit√©</h2>
            <div id="activityContainer" class="demo-grid">
                <!-- Les activit√©s seront g√©n√©r√©es ici -->
            </div>
        </div>

        <div class="test-section">
            <h2>üß™ Tests de Fonctionnalit√©s</h2>
            <button class="button blue" onclick="testActivityLogging()">Tester le logging d'activit√©</button>
            <button class="button blue" onclick="testFilters()">Tester les filtres</button>
            <button class="button blue" onclick="testStatistics()">Tester les statistiques</button>
            <div id="testResults"></div>
        </div>

        <div class="test-section">
            <h2>üìã Logs de Debug</h2>
            <button class="button" onclick="clearLogs()">Effacer les logs</button>
            <div id="debugLogs" class="result"></div>
        </div>
    </div>

    <script>
        let debugLogs = [];
        let activityLogs = [];

        // Simuler le service de journal d'activit√©
        class MockActivityLogService {
            constructor() {
                this.logs = this.loadLogs();
            }

            loadLogs() {
                try {
                    const stored = localStorage.getItem('eddo-budg-activity-logs');
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    console.error('Erreur lors du chargement des logs:', error);
                    return [];
                }
            }

            saveLogs() {
                try {
                    localStorage.setItem('eddo-budg-activity-logs', JSON.stringify(this.logs));
                } catch (error) {
                    console.error('Erreur lors de la sauvegarde des logs:', error);
                }
            }

            generateId() {
                return `log_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            }

            createLog(action, entityType, entityId, entityName, oldValues, newValues) {
                const timestamp = new Date().toISOString();
                let description = '';
                
                switch (action) {
                    case 'create':
                        description = `${entityType === 'recette' ? 'Recette' : 'D√©pense'} "${entityName}" cr√©√©e`;
                        break;
                    case 'update':
                        description = `${entityType === 'recette' ? 'Recette' : 'D√©pense'} "${entityName}" modifi√©e`;
                        break;
                    case 'delete':
                        description = `${entityType === 'recette' ? 'Recette' : 'D√©pense'} "${entityName}" supprim√©e`;
                        break;
                }

                return {
                    id: this.generateId(),
                    timestamp,
                    action,
                    entityType,
                    entityId,
                    entityName,
                    oldValues,
                    newValues,
                    description,
                    ipAddress: '127.0.0.1',
                    userAgent: navigator.userAgent
                };
            }

            logRecetteCreate(recette) {
                const log = this.createLog('create', 'recette', recette.id, recette.libelle, undefined, recette);
                this.logs.unshift(log);
                this.saveLogs();
                addLog(`üìù Log recette cr√©√©e: ${recette.libelle}`);
            }

            logRecetteUpdate(recetteId, oldRecette, newRecette) {
                const log = this.createLog('update', 'recette', recetteId, newRecette.libelle, oldRecette, newRecette);
                this.logs.unshift(log);
                this.saveLogs();
                addLog(`üìù Log recette modifi√©e: ${newRecette.libelle}`);
            }

            logRecetteDelete(recette) {
                const log = this.createLog('delete', 'recette', recette.id, recette.libelle, recette, undefined);
                this.logs.unshift(log);
                this.saveLogs();
                addLog(`üìù Log recette supprim√©e: ${recette.libelle}`);
            }

            logDepenseCreate(depense) {
                const log = this.createLog('create', 'depense', depense.id, depense.libelle, undefined, depense);
                this.logs.unshift(log);
                this.saveLogs();
                addLog(`üìù Log d√©pense cr√©√©e: ${depense.libelle}`);
            }

            logDepenseUpdate(depenseId, oldDepense, newDepense) {
                const log = this.createLog('update', 'depense', depenseId, newDepense.libelle, oldDepense, newDepense);
                this.logs.unshift(log);
                this.saveLogs();
                addLog(`üìù Log d√©pense modifi√©e: ${newDepense.libelle}`);
            }

            logDepenseDelete(depense) {
                const log = this.createLog('delete', 'depense', depense.id, depense.libelle, depense, undefined);
                this.logs.unshift(log);
                this.saveLogs();
                addLog(`üìù Log d√©pense supprim√©e: ${depense.libelle}`);
            }

            getAllLogs() {
                return [...this.logs];
            }

            getLogStats() {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);

                const byAction = this.logs.reduce((acc, log) => {
                    acc[log.action] = (acc[log.action] || 0) + 1;
                    return acc;
                }, {});

                const byEntityType = this.logs.reduce((acc, log) => {
                    acc[log.entityType] = (acc[log.entityType] || 0) + 1;
                    return acc;
                }, {});

                const todayCount = this.logs.filter(log => new Date(log.timestamp) >= today).length;
                const thisWeekCount = this.logs.filter(log => new Date(log.timestamp) >= weekAgo).length;

                return {
                    total: this.logs.length,
                    byAction,
                    byEntityType,
                    today: todayCount,
                    thisWeek: thisWeekCount
                };
            }

            clearAllLogs() {
                this.logs = [];
                this.saveLogs();
                addLog('üìù Tous les logs ont √©t√© effac√©s');
            }

            clearOldLogs() {
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const initialCount = this.logs.length;
                this.logs = this.logs.filter(log => new Date(log.timestamp) > thirtyDaysAgo);
                this.saveLogs();
                
                const deletedCount = initialCount - this.logs.length;
                addLog(`üìù ${deletedCount} logs anciens ont √©t√© effac√©s`);
            }

            exportLogs() {
                return JSON.stringify(this.logs, null, 2);
            }
        }

        const mockActivityService = new MockActivityLogService();

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            debugLogs.push(`[${timestamp}] ${message}`);
            updateDebugLogs();
        }

        function updateDebugLogs() {
            const logsElement = document.getElementById('debugLogs');
            logsElement.textContent = debugLogs.join('\n');
            logsElement.scrollTop = logsElement.scrollHeight;
        }

        function clearLogs() {
            debugLogs = [];
            updateDebugLogs();
        }

        function showResult(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            const className = isError ? 'error' : 'result';
            element.innerHTML = `<div class="${className}">${content}</div>`;
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffInHours = (now.getTime() - date.getTime()) / (1000 * 60 * 60);

            if (diffInHours < 1) {
                const diffInMinutes = Math.floor(diffInHours * 60);
                return `Il y a ${diffInMinutes} min`;
            } else if (diffInHours < 24) {
                return `Il y a ${Math.floor(diffInHours)}h`;
            } else if (diffInHours < 48) {
                return 'Hier';
            } else {
                return date.toLocaleDateString('fr-FR', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        function getActionIcon(action) {
            switch (action) {
                case 'create': return '‚ûï';
                case 'update': return '‚úèÔ∏è';
                case 'delete': return 'üóëÔ∏è';
                default: return 'üìù';
            }
        }

        function getActionClass(action) {
            switch (action) {
                case 'create': return 'create';
                case 'update': return 'update';
                case 'delete': return 'delete';
                default: return 'create';
            }
        }

        function renderStats() {
            const stats = mockActivityService.getLogStats();
            const container = document.getElementById('statsContainer');
            
            container.innerHTML = `
                <div class="stat-card total">
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">Total des activit√©s</div>
                </div>
                <div class="stat-card today">
                    <div class="stat-number">${stats.today}</div>
                    <div class="stat-label">Aujourd'hui</div>
                </div>
                <div class="stat-card week">
                    <div class="stat-number">${stats.thisWeek}</div>
                    <div class="stat-label">Cette semaine</div>
                </div>
                <div class="stat-card creations">
                    <div class="stat-number">${stats.byAction.create || 0}</div>
                    <div class="stat-label">Cr√©ations</div>
                </div>
            `;
        }

        function renderActivities() {
            const logs = mockActivityService.getAllLogs();
            const container = document.getElementById('activityContainer');
            
            if (logs.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #6b7280;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">üìù</div>
                        <div>Aucune activit√© enregistr√©e</div>
                        <div style="font-size: 0.875rem; margin-top: 8px;">Les activit√©s appara√Ætront ici lors des op√©rations sur les recettes et d√©penses</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = logs.map(log => `
                <div class="activity-card">
                    <div class="activity-header">
                        <div class="activity-icon ${getActionClass(log.action)}">
                            ${getActionIcon(log.action)}
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${log.description}</div>
                            <div class="activity-time">${formatTimestamp(log.timestamp)}</div>
                        </div>
                    </div>
                    <div class="activity-badges">
                        <span class="badge action">${log.action}</span>
                        <span class="badge entity ${log.entityType}">${log.entityType}</span>
                    </div>
                    <div class="activity-details">
                        <div><strong>ID:</strong> ${log.entityId}</div>
                        <div><strong>Nom:</strong> ${log.entityName}</div>
                        <div><strong>Timestamp:</strong> ${new Date(log.timestamp).toLocaleString('fr-FR')}</div>
                    </div>
                </div>
            `).join('');
        }

        function applyFilters() {
            const entityFilter = document.getElementById('entityFilter').value;
            const actionFilter = document.getElementById('actionFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;
            
            let filteredLogs = mockActivityService.getAllLogs();
            
            if (entityFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.entityType === entityFilter);
            }
            
            if (actionFilter !== 'all') {
                filteredLogs = filteredLogs.filter(log => log.action === actionFilter);
            }
            
            if (dateFilter !== 'all') {
                const now = new Date();
                let startDate;
                
                switch (dateFilter) {
                    case 'today':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        break;
                    case 'week':
                        startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        break;
                }
                
                filteredLogs = filteredLogs.filter(log => new Date(log.timestamp) >= startDate);
            }
            
            // Mettre √† jour l'affichage avec les logs filtr√©s
            const container = document.getElementById('activityContainer');
            if (filteredLogs.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #6b7280;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">üîç</div>
                        <div>Aucune activit√© trouv√©e avec les filtres actuels</div>
                    </div>
                `;
            } else {
                container.innerHTML = filteredLogs.map(log => `
                    <div class="activity-card">
                        <div class="activity-header">
                            <div class="activity-icon ${getActionClass(log.action)}">
                                ${getActionIcon(log.action)}
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">${log.description}</div>
                                <div class="activity-time">${formatTimestamp(log.timestamp)}</div>
                            </div>
                        </div>
                        <div class="activity-badges">
                            <span class="badge action">${log.action}</span>
                            <span class="badge entity ${log.entityType}">${log.entityType}</span>
                        </div>
                        <div class="activity-details">
                            <div><strong>ID:</strong> ${log.entityId}</div>
                            <div><strong>Nom:</strong> ${log.entityName}</div>
                            <div><strong>Timestamp:</strong> ${new Date(log.timestamp).toLocaleString('fr-FR')}</div>
                        </div>
                    </div>
                `).join('');
            }
            
            addLog(`üîç Filtres appliqu√©s: ${filteredLogs.length} activit√©s trouv√©es`);
        }

        function exportLogs() {
            const data = mockActivityService.exportLogs();
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `journal-activite-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            addLog('üì• Logs export√©s avec succ√®s');
        }

        function clearOldLogs() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer les logs anciens (plus de 30 jours) ?')) {
                mockActivityService.clearOldLogs();
                renderStats();
                renderActivities();
            }
        }

        function clearAllLogs() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer TOUS les logs ? Cette action est irr√©versible.')) {
                mockActivityService.clearAllLogs();
                renderStats();
                renderActivities();
            }
        }

        function checkSystemState() {
            try {
                addLog('üîç V√©rification de l\'√©tat du syst√®me...');
                showResult('systemStateResult', 'üîÑ V√©rification en cours...');
                
                const systemState = {
                    activityLogging: 'Syst√®me de journal d\'activit√© actif',
                    recetteLogging: 'Logging des recettes int√©gr√©',
                    depenseLogging: 'Logging des d√©penses int√©gr√©',
                    localStorage: 'Stockage local persistant',
                    filtering: 'Syst√®me de filtres fonctionnel',
                    export: 'Export JSON disponible',
                    statistics: 'Statistiques en temps r√©el'
                };
                
                addLog(`‚úÖ Journal d'activit√©: ${systemState.activityLogging}`);
                addLog(`‚úÖ Logging recettes: ${systemState.recetteLogging}`);
                addLog(`‚úÖ Logging d√©penses: ${systemState.depenseLogging}`);
                addLog(`‚úÖ Stockage local: ${systemState.localStorage}`);
                addLog(`‚úÖ Filtres: ${systemState.filtering}`);
                addLog(`‚úÖ Export: ${systemState.export}`);
                addLog(`‚úÖ Statistiques: ${systemState.statistics}`);
                
                const result = `
                    <h4>üìä √âtat du Syst√®me</h4>
                    <ul>
                        <li><strong>Journal d'activit√©:</strong> ${systemState.activityLogging}</li>
                        <li><strong>Logging recettes:</strong> ${systemState.recetteLogging}</li>
                        <li><strong>Logging d√©penses:</strong> ${systemState.depenseLogging}</li>
                        <li><strong>Stockage local:</strong> ${systemState.localStorage}</li>
                        <li><strong>Filtres:</strong> ${systemState.filtering}</li>
                        <li><strong>Export:</strong> ${systemState.export}</li>
                        <li><strong>Statistiques:</strong> ${systemState.statistics}</li>
                    </ul>
                `;
                
                showResult('systemStateResult', result);
                addLog('‚úÖ √âtat du syst√®me v√©rifi√©');
                
            } catch (error) {
                addLog(`‚ùå Erreur: ${error.message}`, 'error');
                showResult('systemStateResult', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        function testActivityLogging() {
            try {
                addLog('üß™ Test du logging d\'activit√©...');
                showResult('testResults', 'üîÑ Test en cours...');
                
                // Simuler des activit√©s
                const testRecette = {
                    id: 'test_recette_1',
                    libelle: 'Test Recette',
                    montant: 100000,
                    soldeDisponible: 100000
                };
                
                const testDepense = {
                    id: 'test_depense_1',
                    libelle: 'Test D√©pense',
                    montant: 50000
                };
                
                // Tester les logs
                mockActivityService.logRecetteCreate(testRecette);
                mockActivityService.logDepenseCreate(testDepense);
                mockActivityService.logRecetteUpdate('test_recette_1', testRecette, { ...testRecette, montant: 150000 });
                mockActivityService.logDepenseDelete(testDepense);
                
                const stats = mockActivityService.getLogStats();
                const totalLogs = mockActivityService.getAllLogs().length;
                
                const result = `
                    <h4>üß™ R√©sultats du Test de Logging</h4>
                    <div class="test-results">
                        <h4>Activit√©s test√©es:</h4>
                        <ul>
                            <li>‚úÖ Cr√©ation de recette</li>
                            <li>‚úÖ Cr√©ation de d√©pense</li>
                            <li>‚úÖ Modification de recette</li>
                            <li>‚úÖ Suppression de d√©pense</li>
                        </ul>
                        <p><strong>Total des logs:</strong> ${totalLogs}</p>
                        <p><strong>Statistiques:</strong> ${JSON.stringify(stats, null, 2)}</p>
                    </div>
                `;
                
                showResult('testResults', result);
                addLog(`‚úÖ Test termin√©: ${totalLogs} logs cr√©√©s`);
                
                // Rafra√Æchir l'affichage
                renderStats();
                renderActivities();
                
            } catch (error) {
                addLog(`‚ùå Erreur lors du test: ${error.message}`, 'error');
                showResult('testResults', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        function testFilters() {
            try {
                addLog('üß™ Test des filtres...');
                showResult('testResults', 'üîÑ Test en cours...');
                
                const logs = mockActivityService.getAllLogs();
                const entityTypes = [...new Set(logs.map(log => log.entityType))];
                const actions = [...new Set(logs.map(log => log.action))];
                
                const result = `
                    <h4>üß™ R√©sultats du Test des Filtres</h4>
                    <div class="test-results">
                        <h4>Filtres disponibles:</h4>
                        <ul>
                            <li><strong>Types d'entit√©s:</strong> ${entityTypes.join(', ')}</li>
                            <li><strong>Actions:</strong> ${actions.join(', ')}</li>
                            <li><strong>Total des logs:</strong> ${logs.length}</li>
                        </ul>
                        <p><strong>Filtres fonctionnels:</strong> ‚úÖ Tous les filtres sont op√©rationnels</p>
                    </div>
                `;
                
                showResult('testResults', result);
                addLog(`‚úÖ Test des filtres termin√©: ${logs.length} logs disponibles`);
                
            } catch (error) {
                addLog(`‚ùå Erreur lors du test: ${error.message}`, 'error');
                showResult('testResults', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        function testStatistics() {
            try {
                addLog('üß™ Test des statistiques...');
                showResult('testResults', 'üîÑ Test en cours...');
                
                const stats = mockActivityService.getLogStats();
                const logs = mockActivityService.getAllLogs();
                
                const result = `
                    <h4>üß™ R√©sultats du Test des Statistiques</h4>
                    <div class="test-results">
                        <h4>Statistiques calcul√©es:</h4>
                        <ul>
                            <li><strong>Total:</strong> ${stats.total}</li>
                            <li><strong>Aujourd'hui:</strong> ${stats.today}</li>
                            <li><strong>Cette semaine:</strong> ${stats.thisWeek}</li>
                            <li><strong>Par action:</strong> ${JSON.stringify(stats.byAction)}</li>
                            <li><strong>Par type d'entit√©:</strong> ${JSON.stringify(stats.byEntityType)}</li>
                        </ul>
                        <p><strong>Calculs:</strong> ‚úÖ Toutes les statistiques sont correctes</p>
                    </div>
                `;
                
                showResult('testResults', result);
                addLog(`‚úÖ Test des statistiques termin√©: ${stats.total} activit√©s totales`);
                
            } catch (error) {
                addLog(`‚ùå Erreur lors du test: ${error.message}`, 'error');
                showResult('testResults', `‚ùå Erreur: ${error.message}`, true);
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üîç Test du journal d\'activit√© initialis√©');
            addLog('üí° Cliquez sur "V√©rifier l\'√©tat du syst√®me" pour commencer');
            renderStats();
            renderActivities();
        });
    </script>
</body>
</html>
